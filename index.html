<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="ณสามารถสร้างรูปโปรไฟล์เรารักในหลวงได้ง่ายๆ เพียงกรอกชื่อแล้วกดดาวน์โหลดได้ทันที">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="author" content="Earthchie <earthchie@gmail.com>">
    <title>สร้างรูปเรารักในหลวง</title>
    <meta property="fb:app_id" content="113581508678006" />
    <meta property="fb:admins" content="581849270" />
    <meta property="og:site_name" content="สร้างรูปเรารักในหลวง" />
    <meta property="og:url" content="https://earthchie.com/loveking/" />
    <meta property="og:title" content="เครื่องมือสร้างรูปเรารักในหลวง" />
    <meta property="og:image" content="og.jpg" />
    <meta property="og:description" content="คุณสามารถสร้างรูปโปรไฟล์เรารักในหลวงได้ง่ายๆ เพียงกรอกชื่อแล้วกดดาวน์โหลดได้ทันที" />
    <meta property="og:locale" content="th_TH" />
    <meta property="og:type" content="website" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://code.getmdl.io/1.2.1/material.indigo-pink.min.css">
    <link rel="stylesheet" href="fonts/fonts.css">
    <link rel="stylesheet" href="fonts/icons/style.css">
    <link rel="stylesheet" href="styles.css">
    <script>
        (function (i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
            a = s.createElement(o), m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');
        ga('create', 'UA-33058582-1', 'auto', {
            'name': 'Main'
        });
        ga('send', 'pageview');
        ga('Main.send', 'event', 'สร้างรูปเรารักในหลวง', 'view', '');
    </script>
</head>

<body>
    <div id="fb-root"></div>
    
    <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
        <header class="mdl-layout__header">
            <div class="mdl-layout__header-row"> <span class="mdl-layout-title font-title" style="font-size:2.2em">
                    <i class="material-icons">favorite</i> สร้างรูปเรารักในหลวง
                </span> </div>
        </header>
        <main class="mdl-layout__content">
            <div class="page-content">
                <p class="text-center container">
                    <a href="http://king.kapook.com/farewell" target="_blank"> <img src="farewell.png" alt=""> </a>
                </p>
                <div class="mdl-grid">
                    <div class="mdl-cell mdl-cell--6-col text-right">
                        <canvas id="canvas" width=600 height=600 style="float:right"></canvas>
                        <br style="clear:both">
                        <p> ขอขอบคุณ <a href="https://www.facebook.com/domecloud.io/" target="_blank">DomeCloud co., ltd. </a> ที่ช่วยให้เว็บไม่ล่ม
                            <br> ขอบคุณทีมงาน <a href="https://www.facebook.com/teamsocial.co/" target="_blank">ทีมโซเชียล</a> ผู้เชี่ยวชาญการทำ Online Marketing </p>
                    </div>
                    <div class="mdl-cell mdl-cell--6-col">
                        <h1 class="font-title">กรอกชื่อของคุณ</h1>
                        <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                            <input class="mdl-textfield__input" type="text" id="username" value="เรา">
                            <label class="mdl-textfield__label" for="username">ชื่อของคุณ</label>
                        </div>
                        <br>
                        <div class="mdl-textfield mdl-js-textfield" style="width:300px;">
                            <label for="offset">ปรับตำแหน่ง</label>
                            <input id="offset" class="mdl-slider mdl-js-slider" type="range" min="0" max="200" value="125" tabindex="0"> </div>
                        <br>
                        <div class="mdl-textfield mdl-js-textfield" style="width:300px;">
                            <label for="offset">ขนาดตัวอักษร</label>
                            <input id="fontsize" class="mdl-slider mdl-js-slider" type="range" min="30" max="150" value="70" tabindex="0"> </div>
                        <div class="text-center" style="width:400px;">
                            <div class="mdl-grid">
                                <div class="mdl-cell mdl-cell--6-col">
                                    <div style="width:80%;"> <a id="share2fb" class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored" style="width:100%"><span class="icon-facebook"></span> โพสต์ลงเฟซบุค</a>
                                        <input type="hidden" id="fb_profile"> </div>
                                </div>
                                <div class="mdl-cell mdl-cell--6-col">
                                    <div style="width:80%;"> <a id="download" class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored" style="background:rgb(76, 175, 80);width:100%"><i class="material-icons" style="top:0;">file_download</i> ดาวน์โหลด</a> </div>
                                </div>
                            </div>
                        </div>
                        <div style="width:300px;">
                            <br>
                            <br>
                            <div class="fb-like" data-href="https://earthchie.com/loveking/" data-layout="standard" data-action="like" data-size="small" data-show-faces="true" data-share="true"></div>
                        </div>
                        <hr style="width:300px;">
                        <p> ขอพระองค์ ทรงพระเจริญ
                            <br> ด้วยเกล้าด้วยกระหม่อม ขอเดชะ
                            <br> ข้าพระพุทธเจ้า ทีมงาน <a href="https://www.facebook.com/teamsocial.co/" target="_blank">TeamSocial</a> และ ทีมงาม <a href="https://www.facebook.com/domecloud.io/" target="_blank">DomeCloud</a> </p> <small>
                            - ขอขอบคุณ <a href="https://www.facebook.com/kulthida.rotchanawit/media_set?set=a.10153936040086444.1073741907.628211443&type=3" target="_blank">Kulthida Kul</a> ผู้ออกแบบและผู้ปลุกกระแส <br>
                            - ขอบคุณฟอนต์น่ารักๆ <a href="http://www.f0nt.com/release/5011_the_little_uki_noworry/" target="_blank">5011_the_little_uki_noworry</a><br>
                            - Source Code อยู่ที่ <a href="https://github.com/earthchie/we_love_the_king_generator/" target="_blank">Github</a> ภายใต้ลิขสิทธิ์ <a href="http://www.wtfpl.net/about/" target="_blank"> WTFPL 2.0</a>
                            
                        </small> </div>
                </div>
                <div class="container">
                    <hr>
                    <h2 style="font-size:2em">คอมเมนต์ <br> <small>(ตรงนี้ไม่ใช่ช่องกรอกชื่อนะครับ ไปกรอกด้านบน)</small></h2>
                    <div class="fb-comments" data-href="https://earthchie.com/loveking/" data-numposts="5" width="100%"></div>
                </div>
            </div>
        </main>
    </div>
    <script defer src="https://code.getmdl.io/1.2.1/material.min.js"></script>
    <script src="jquery.min.js"></script>
    <script>
        $(function () {
            var username = document.getElementById('username')
                , offset = document.getElementById('offset')
                , share2fb = document.getElementById('share2fb')
                , fontsize = document.getElementById('fontsize')
                , download = document.getElementById('download')
                , canvas = document.getElementById('canvas')
                , context = canvas.getContext('2d')
                , render = function () {
                    window.location.hash = username.value;
                    var img = new Image();
                    img.onload = function () {
                        context.drawImage(img, 0, 0, img.width, img.height, 0, 0, canvas.width, canvas.height);
                        context.fillStyle = '#fff';
                        context.font = 'normal ' + (+fontsize.value) + 'px noworry';
                        context.fillText(username.value, +offset.value, 310);
                        context.font = 'normal 70px noworry';
                        context.fillText('ในหลวง', 400, 310);
                    };
                    img.src = 'bg.png';
                }
                , isFacebookApp = function () {
                    var ua = navigator.userAgent || navigator.vendor || window.opera;
                    return (ua.indexOf("FBAN") > -1) || (ua.indexOf("FBAV") > -1);
                };
            if (isFacebookApp()) {
                // @TODO: modal box to instruct users from in-app facebook browser to open in external browser
            }
            if (window.location.hash) {
                username.value = decodeURIComponent(window.location.hash.replace(/#|@(.)+/g, '') || 'เรา');
            }
            render();
            username.onkeyup = render;
            username.onchange = render;
            offset.oninput = render;
            fontsize.oninput = render;
            download.onclick = function (e) {
                ga('Main.send', 'event', 'สร้างรูปเรารักในหลวง - Download', 'view', username.value);
                this.href = canvas.toDataURL();
                this.download = 'We_Love_the_King.png';
            };
            $.getScript('//connect.facebook.net/en_th/sdk.js', function () {
                FB.init({
                    appId: '113581508678006'
                    , version: 'v2.1'
                });
                FB.XFBML.parse();
                share2fb.onclick = function () {
                    var data = canvas.toDataURL('image/png')
                        , blob;
                    try {
                        blob = dataURItoBlob(data);
                    }
                    catch (e) {
                        console.log(e);
                    }
                    var handler = function (s, res) {
                        if (s) {
                            window.location.href = 'https://www.facebook.com/me/posts/' + res.id.split('_')[1];
                        }
                        else {
                            alert('พบข้อผิดพลาด กรุณาลองใหม่อีกครั้ง');
                        }
                    }
                    FB.login(function (response) {
                        postImageToFacebook(response.authResponse.accessToken, blob, handler);
                    }, {
                        scope: "publish_actions"
                    });
                }
            });
        })

        function dataURItoBlob(dataURI) {
            var byteString = atob(dataURI.split(',')[1]);
            var ab = new ArrayBuffer(byteString.length);
            var ia = new Uint8Array(ab);
            for (var i = 0; i < byteString.length; i++) {
                ia[i] = byteString.charCodeAt(i);
            }
            return new Blob([ab], {
                type: 'image/png'
            });
        }

        function postImageToFacebook(token, imageData, callback) {
            var fd = new FormData();
            fd.append("access_token", token);
            fd.append("source", imageData);
            fd.append("no_story", true);
            // Upload image to facebook without story(post to feed)
            $.ajax({
                url: "https://graph.facebook.com/me/photos?access_token=" + token
                , type: "POST"
                , data: fd
                , processData: false
                , contentType: false
                , cache: false
                , success: function (data) {
                    FB.api("/me/feed", "POST", {
                        , "link": 'https://www.facebook.com/photo.php?fbid=' + data.id
                    , }, function (response) {
                        if (response && !response.error) {
                            callback(true, response);
                        }
                        else {
                            callback(false, response)
                        }
                    });
                }
            });
        }
    </script>
</body>

</html>